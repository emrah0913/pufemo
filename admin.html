<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PUFEMO - Yönetim Paneli</title>
<style>
  /* ... stil kısmı admin paneldeki önceki kodla aynı ... */
  body { font-family: Arial, sans-serif; background:#f5f7fa; margin:0; }
  header { background:#27ae60; color:#fff; padding:15px 30px; font-size:22px; font-weight:bold; }
  nav { background:#fff; padding:15px 30px; display:flex; gap:20px; flex-wrap: wrap; }
  nav button { background:#27ae60; color:#fff; border:none; padding:10px 20px; border-radius:5px; cursor:pointer; }
  nav button:hover { background:#219150; }
  main { padding: 20px 30px; min-height: 600px; background:#fff; }
  table { width: 100%; border-collapse: collapse; margin-top: 20px; }
  th, td { border: 1px solid #ccc; padding: 10px; text-align: left; }
  th { background: #eee; }
  .delete-btn, .small-btn {
    background: #e74c3c; margin: 0; padding: 6px 10px; font-size: 12px; border-radius: 3px;
    color:#fff; border:none; cursor:pointer;
  }
  .delete-btn:hover, .small-btn:hover { background: #c0392b; }
  input, textarea, select, button {
    padding: 10px; margin-bottom: 15px; border-radius: 5px; border: 1px solid #ccc; font-size: 14px;
  }
  button.submit-btn {
    background: #27ae60; color: white; border: none; cursor: pointer;
  }
  button.submit-btn:hover {
    background: #219150;
  }
  #login-container {
    max-width: 400px; margin: 80px auto; background:#fff; padding:30px; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,0.15);
  }
  #login-container h2 {
    margin-bottom: 20px; text-align:center;
  }
  #login-container form {
    display: flex;
    flex-direction: column;
  }
  #login-container input {
    width: 100%; margin-bottom: 15px; padding: 10px; font-size: 14px; border: 1px solid #ccc; border-radius: 5px;
  }
  #login-container button {
    width: 100%; padding: 10px; background: #27ae60; color: white; border: none; cursor: pointer; border-radius: 5px;
  }
  #login-container button:hover {
    background: #219150;
  }
  #error-msg {
    color: red; margin-bottom: 15px; text-align: center;
  }
</style>
</head>
<body>

<div id="login-container">
  <h2>Admin Girişi</h2>
  <div id="error-msg"></div>
  <form id="login-form">
    <input type="email" id="email" placeholder="E-posta" value="emirmob09@gmail.com" required />
    <input type="password" id="password" placeholder="Şifre" value="1emıremo" required />
    <button type="submit" id="login-btn">Giriş Yap</button>
  </form>
</div>

<header id="header" style="display:none;">PUFEMO Yönetim Paneli</header>
<nav id="nav" style="display:none;">
  <button onclick="showSection('products')">Ürünler</button>
  <button onclick="showSection('categories')">Kategoriler</button>
  <button onclick="showSection('countries')">Ülkeler</button>
  <button onclick="showSection('variants')">Varyantlar</button>
  <button onclick="showSection('orders')">Siparişler</button>
  <button id="logout-btn" style="margin-left:auto; background:#e67e22;">Çıkış Yap</button>
</nav>
<main id="content" style="display:none;">
  <p>Modül seçiniz...</p>
</main>

<script type="module">
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
  import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';
  import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';

  const firebaseConfig = {
    apiKey: "AIzaSyDYkzZzNXB22U4oEXxOoPh-puwuE8kz0g4",
    authDomain: "pufemo-com.firebaseapp.com",
    projectId: "pufemo-com",
    storageBucket: "pufemo-com.firebasestorage.app",
    messagingSenderId: "983352837227",
    appId: "1:983352837227:web:defaa8dae215776e2e",
    measurementId: "G-RH8XHC7P91"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);
  const ADMIN_UID = "4tOeNJRjbxPF9BBoynJNJIBxOqU2";

  const loginContainer = document.getElementById('login-container');
  const header = document.getElementById('header');
  const nav = document.getElementById('nav');
  const content = document.getElementById('content');
  const errorMsg = document.getElementById('error-msg');
  const loginForm = document.getElementById('login-form');
  const logoutBtn = document.getElementById('logout-btn');

  loginForm.addEventListener('submit', e => {
    e.preventDefault();
    errorMsg.textContent = '';
    const email = loginForm.email.value.trim();
    const password = loginForm.password.value;

    if (!email || !password) {
      errorMsg.textContent = 'Lütfen e-posta ve şifre girin.';
      return;
    }

    signInWithEmailAndPassword(auth, email, password)
      .then(({ user }) => {
        if (user.uid !== ADMIN_UID) {
          errorMsg.textContent = 'Yetkiniz yok.';
          signOut(auth);
          return;
        }
        showAdminPanel();
      })
      .catch(err => {
        errorMsg.textContent = 'Giriş başarısız: ' + err.message;
      });
  });

  logoutBtn.onclick = () => {
    signOut(auth);
  };

  onAuthStateChanged(auth, user => {
    if (user && user.uid === ADMIN_UID) {
      showAdminPanel();
    } else {
      hideAdminPanel();
    }
  });

  function showAdminPanel() {
    loginContainer.style.display = 'none';
    header.style.display = 'block';
    nav.style.display = 'flex';
    content.style.display = 'block';
    showSection('products');
  }

  function hideAdminPanel() {
    loginContainer.style.display = 'block';
    header.style.display = 'none';
    nav.style.display = 'none';
    content.style.display = 'none';
  }

  async function showSection(name) {
    switch(name) {
      case 'products': await renderProducts(); break;
      case 'categories': await renderCategories(); break;
      case 'countries': await renderCountries(); break;
      case 'variants': await renderVariants(); break;
      case 'orders': await renderOrders(); break;
      default: content.innerHTML = '<p>Modül seçiniz...</p>';
    }
  }

  // Ürün Yönetimi
  async function renderProducts() {
    content.innerHTML = `
      <h2>Ürün Yönetimi</h2>
      <form id="product-form">
        <input type="text" id="title-tr" placeholder="Ürün Adı (Türkçe)" required />
        <input type="text" id="title-en" placeholder="Product Name (English)" required />
        <textarea id="desc-tr" placeholder="Ürün Açıklaması (Türkçe)"></textarea>
        <textarea id="desc-en" placeholder="Product Description (English)"></textarea>
        <input type="number" id="base-price" placeholder="Ana Fiyat (₺)" required min="0" step="0.01" />
        <input type="text" id="image-url" placeholder="Görsel URL" />
        <select id="category-select" required>
          <option value="">Kategori Seçiniz</option>
        </select>
        <button type="submit" class="submit-btn">Yeni Ürün Ekle</button>
      </form>
      <table>
        <thead>
          <tr>
            <th>ID</th><th>Türkçe Adı</th><th>İngilizce Adı</th><th>Kategori</th><th>Ana Fiyat (₺)</th><th>İşlemler</th>
          </tr>
        </thead>
        <tbody id="product-list"></tbody>
      </table>
    `;
    await loadCategoriesIntoSelect();
    await loadProducts();

    document.getElementById('product-form').addEventListener('submit', async e => {
      e.preventDefault();
      await addProduct();
    });
  }

  async function loadCategoriesIntoSelect() {
    const select = document.getElementById('category-select');
    select.innerHTML = '<option value="">Kategori Seçiniz</option>';
    const snapshot = await getDocs(collection(db, 'categories'));
    snapshot.forEach(docSnap => {
      const cat = docSnap.data();
      const title = cat.translations?.tr?.title || 'Kategori';
      select.innerHTML += `<option value="${docSnap.id}">${title}</option>`;
    });
  }

  async function loadProducts() {
    const tbody = document.getElementById('product-list');
    tbody.innerHTML = '<tr><td colspan="6">Yükleniyor...</td></tr>';
    const snapshot = await getDocs(collection(db, 'products'));
    const categoriesSnap = await getDocs(collection(db, 'categories'));
    const categoriesMap = {};
    categoriesSnap.forEach(d => categoriesMap[d.id] = d.data());

    let html = '';
    snapshot.forEach(docSnap => {
      const p = docSnap.data();
      const cat = categoriesMap[p.categoryId];
      const catName = cat ? (cat.translations?.tr?.title || 'Kategori') : 'Kategori Yok';
      html += `
        <tr>
          <td>${docSnap.id}</td>
          <td>${p.translations?.tr?.title || '-'}</td>
          <td>${p.translations?.en?.title || '-'}</td>
          <td>${catName}</td>
          <td>${p.basePrice.toFixed(2)} ₺</td>
          <td><button class="delete-btn" onclick="deleteProduct('${docSnap.id}')">Sil</button></td>
        </tr>
      `;
    });
    tbody.innerHTML = html || '<tr><td colspan="6" style="text-align:center;">Ürün bulunamadı.</td></tr>';
  }

  async function addProduct() {
    const titleTr = document.getElementById('title-tr').value.trim();
    const titleEn = document.getElementById('title-en').value.trim();
    const descTr = document.getElementById('desc-tr').value.trim();
    const descEn = document.getElementById('desc-en').value.trim();
    const basePrice = parseFloat(document.getElementById('base-price').value);
    const imageUrl = document.getElementById('image-url').value.trim();
    const categoryId = document.getElementById('category-select').value;

    if (!titleTr || !titleEn || isNaN(basePrice) || !categoryId) {
      alert('Lütfen tüm zorunlu alanları doldurun.');
      return;
    }

    const newProduct = {
      basePrice,
      categoryId,
      translations: {
        tr: { title: titleTr, description: descTr },
        en: { title: titleEn, description: descEn }
      },
      images: imageUrl ? [imageUrl] : []
    };

    try {
      await addDoc(collection(db, 'products'), newProduct);
      alert('Ürün başarıyla eklendi.');
      await loadProducts();
      document.getElementById('product-form').reset();
    } catch (err) {
      console.error(err);
      alert('Ürün eklenirken hata oluştu.');
    }
  }

  window.deleteProduct = async function(id) {
    if (!confirm('Ürünü silmek istediğinize emin misiniz?')) return;
    try {
      await deleteDoc(doc(db, 'products', id));
      alert('Ürün silindi.');
      await loadProducts();
    } catch (err) {
      console.error(err);
      alert('Ürün silinirken hata oluştu.');
    }
  };

  // Diğer yönetim modülleri buraya benzer şekilde eklenebilir...
  // (Kategori, Ülke, Varyant, Sipariş yönetimi)

  // ...Aynı yapıda devam edebilirim, istersen söyle lütfen.

  // Diğer modüller istersen ekleyeyim.
</script>

</body>
</html>
