<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PUFEMO - Ana Sayfa</title>
<style>
  body { font-family: Arial, sans-serif; margin: 0; background: #f0f0f0; }
  header { background: #27ae60; color: white; padding: 15px; text-align: center; font-size: 24px; }
  main { padding: 20px; max-width: 1200px; margin: auto; }
  .product-list { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; }
  .product-card { background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); width: 220px; padding: 15px; display: flex; flex-direction: column; }
  .product-card img { width: 100%; border-radius: 6px; object-fit: cover; height: 150px; }
  .product-title { font-weight: bold; margin-top: 10px; }
  .product-category { font-size: 13px; color: #666; margin: 3px 0; }
  .product-price { margin-top: auto; font-size: 18px; color: #27ae60; font-weight: bold; }
</style>
</head>
<body>

<header>PUFEMO - Modern Mobilyalar</header>

<main>
  <div class="product-list" id="product-list">
    Yükleniyor...
  </div>
</main>

<script type="module">
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
  import { getFirestore, collection, getDocs } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';

  const firebaseConfig = {
    apiKey: "AIzaSyDYkzZzNXB22U4oEXxOoPh-puwuE8kz0g4",
    authDomain: "pufemo-com.firebaseapp.com",
    projectId: "pufemo-com",
    storageBucket: "pufemo-com.firebasestorage.app",
    messagingSenderId: "983352837227",
    appId: "1:983352837227:web:defaa8dae215776e2e1d2e",
    measurementId: "G-RH8XHC7P91"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const productListEl = document.getElementById('product-list');

  async function loadProducts() {
    productListEl.innerHTML = 'Yükleniyor...';

    const productsSnap = await getDocs(collection(db, 'products'));
    const categoriesSnap = await getDocs(collection(db, 'categories'));

    // Kategori ID - isim eşlemesi
    const categoriesMap = {};
    categoriesSnap.forEach(catDoc => {
      const cat = catDoc.data();
      categoriesMap[catDoc.id] = cat.translations?.tr?.title || 'Kategori';
    });

    if (productsSnap.empty) {
      productListEl.innerHTML = '<p>Ürün bulunamadı.</p>';
      return;
    }

    let html = '';
    productsSnap.forEach(prodDoc => {
      const p = prodDoc.data();
      const catName = categoriesMap[p.categoryId] || 'Kategori Yok';
      const price = typeof p.basePrice === 'number' ? p.basePrice.toFixed(2) : '0.00';
      const img = p.images && p.images.length > 0 ? p.images[0] : 'https://via.placeholder.com/220x150?text=No+Image';

      html += `
        <div class="product-card">
          <img src="${img}" alt="${p.translations?.tr?.title || 'Ürün'}" />
          <div class="product-title">${p.translations?.tr?.title || '-'}</div>
          <div class="product-category">${catName}</div>
          <div class="product-price">${price} ₺</div>
        </div>
      `;
    });

    productListEl.innerHTML = html;
  }

  loadProducts();
</script>

</body>
</html>
