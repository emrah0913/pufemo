<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Türkiye'den Kıbrıs'a Sipariş Getirme Hizmeti | Getir Kıbrıs</title>
<script src="https://cdn.tailwindcss.com/3.4.16"></script>
<script>
    tailwind.config = {
        theme: {
            extend: {
                colors: { primary: '#5d3ebc', secondary: '#ffd300' },
                borderRadius: { DEFAULT: '8px', button: '8px' }
            }
        }
    }
</script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css">
<style>
    body { font-family: 'Inter', sans-serif; background-color: #f9f9f9; }
</style>
</head>
<body class="bg-gray-50">
<div class="w-full max-w-screen-lg mx-auto relative min-h-screen pb-16">

    <header class="fixed top-0 w-full bg-white shadow-sm z-50 px-4 py-3 flex items-center justify-between">
        <div class="flex-1"></div>
        <a href="index.html" class="flex flex-col items-center"><img src="logom.png" alt="Getir Kıbrıs" class="h-12"></a>
        <div class="flex-1 flex justify-end items-center gap-4">
            <a href="sepet.html" class="relative text-gray-600 hover:text-primary"><i class="ri-shopping-cart-line ri-xl"></i><span id="cart-counter" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center hidden">0</span></a>
            <div id="auth-button" class="w-8 h-8 flex items-center justify-center">
                <button id="login-btn" class="text-primary font-medium cursor-pointer"><i class="ri-user-line ri-lg"></i></button>
                <div id="profile-container" class="hidden"><img id="profile-img" src="" alt="Profil" class="w-8 h-8 rounded-full cursor-pointer"></div>
            </div>
        </div>
    </header>

    <main class="pt-20 pb-20">
        <div class="relative w-full h-64 sm:h-80 lg:h-[450px] overflow-hidden mb-8">
            <video class="w-full h-full object-cover" autoplay loop muted playsinline poster="https://readdy.ai/api/search-image?query=online%20shopping%20and%20delivery%20service%2C%20modern%20lifestyle%2C%20soft%20lighting%2C%20clean%20background%2C%20banner%20image&width=800&height=400&seq=1&orientation=landscape"><source src="https://public.readdy.ai/assets/sample.mp4" type="video/mp4"></video>
            <div class="absolute inset-0 bg-gradient-to-t from-primary/70 to-transparent pointer-events-none"></div>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 px-4 mb-8">
            <button id="calculate-btn" class="bg-white shadow-md p-4 rounded-button flex flex-col items-center justify-center h-32 cursor-pointer border hover:border-primary/20 transition-all">
                <div class="w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mb-2"><i class="ri-calculator-line ri-xl text-primary"></i></div>
                <span class="text-sm font-medium">Hesapla & Sepete Ekle</span>
            </button>
            <a href="sepet.html" class="bg-white shadow-md p-4 rounded-button flex flex-col items-center justify-center h-32 cursor-pointer border hover:border-primary/20 transition-all">
                <div class="w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mb-2"><i class="ri-file-list-3-line ri-xl text-primary"></i></div>
                <span class="text-sm font-medium">Siparişlerim</span>
            </a>
            <a href="https://wa.me/905391090879" target="_blank" class="bg-white shadow-md p-4 rounded-button flex flex-col items-center justify-center h-32 cursor-pointer border hover:border-primary/20 transition-all">
                <div class="w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mb-2"><i class="ri-whatsapp-line ri-xl text-primary"></i></div>
                <span class="text-sm font-medium">WhatsApp Destek</span>
            </a>
        </div>

        <div id="calculator-section" class="bg-white rounded-lg shadow-md mx-4 p-6 mb-8 hidden">
             <h3 class="text-lg font-semibold mb-4 text-primary">Ürün Bilgilerini Girin</h3>
             <form id="calculator-form" class="space-y-4">
                <div>
                    <label for="order-method" class="block text-sm font-medium text-gray-700 mb-1">Sipariş Yöntemi<span class="text-red-500">*</span></label>
                    <select id="order-method" required class="w-full p-2 border border-gray-300 rounded-md"><option value="" disabled selected>Seçin...</option><option value="self">Ürünü ben alacağım, kargo sizden</option><option value="service">Ürünü benim için siz alın</option></select>
                </div>
                <div>
                    <label for="product-link" class="block text-sm font-medium text-gray-700 mb-1">Ürün Linki<span class="text-red-500">*</span></label>
                    <input type="url" id="product-link" required class="w-full p-2 border border-gray-300 rounded-md" placeholder="https://...">
                </div>
                <div>
                    <label for="product-price" class="block text-sm font-medium text-gray-700 mb-1">Ürün Fiyatı (₺)<span class="text-red-500">*</span></label>
                    <input type="number" id="product-price" required class="w-full p-2 border border-gray-300 rounded-md" placeholder="0.00" step="any" min="0.01">
                </div>
                <div>
                    <label for="product-category" class="block text-sm font-medium text-gray-700 mb-1">Kategori<span class="text-red-500">*</span></label>
                    <select id="product-category" required class="w-full p-2 border border-gray-300 rounded-md"><option value="" disabled selected>Seçin...</option><option value="furniture">Mobilya</option><option value="electronics">Elektronik</option><option value="clothing">Giyim</option><option value="cosmetics">Kozmetik</option><option value="stationery">Kırtasiye</option></select>
                </div>
                <button type="submit" id="add-to-cart-btn" class="w-full bg-primary text-white py-3 rounded-button font-medium disabled:opacity-50 disabled:cursor-not-allowed" disabled>Ayarlar Yükleniyor...</button>
             </form>
        </div>
        
        <section id="testimonials-section" class="px-4 py-8 mb-8">
            <h3 class="text-2xl font-bold text-center text-primary mb-8">Müşterilerimiz Ne Diyor?</h3>
            <div id="testimonials-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </section>
    </main>
    <footer class="w-full py-4 text-center"><p class="text-xs text-gray-500 mt-2">&copy; 2025 Getir Kıbrıs.</p></footer>
</div>

<div id="login-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden"><div class="bg-white rounded-lg p-6 w-full max-w-xs relative"><button id="close-login-modal" class="absolute top-3 right-3"><i class="ri-close-line ri-lg"></i></button><h3 class="text-xl font-semibold text-center mb-4">Giriş Yap</h3><button id="google-login-btn" class="w-full flex items-center justify-center gap-2 border rounded py-3 font-medium hover:bg-gray-50"><i class="ri-google-fill text-red-500"></i>Google ile Giriş</button></div></div>
<div id="auth-required-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden"><div class="bg-white rounded-lg p-6 w-full max-w-xs text-center"><h3 class="text-xl font-semibold">Giriş Gerekli</h3><p class="text-sm mt-2">Bu özelliği kullanmak için giriş yapmalısınız.</p><button id="auth-login-btn" class="w-full mt-6 bg-primary text-white py-2 rounded">Giriş Yap</button><button id="close-auth-modal" class="w-full mt-1 py-2">Kapat</button></div></div>
<div id="complete-profile-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden"><div class="bg-white rounded-lg p-6 w-full max-w-sm"><h3 class="text-xl font-semibold mb-4">Profilinizi Tamamlayın</h3><form id="complete-profile-form" class="space-y-4"><input type="text" id="profile-fullname" placeholder="Ad Soyad" required class="w-full p-2 border rounded"><input type="tel" id="profile-phone" placeholder="Telefon" required class="w-full p-2 border rounded"><textarea id="profile-address" placeholder="Varsayılan Teslimat Adresi" required rows="3" class="w-full p-2 border rounded"></textarea><button type="submit" class="w-full bg-primary text-white py-2 rounded">Kaydet</button></form></div></div>
<div id="toast" class="fixed bottom-20 left-1/2 -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded-lg opacity-0 transition-all duration-300"><span id="toast-message"></span></div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
    // Sayfa tamamen yüklendiğinde script'i çalıştır. Bu en güvenli yöntemdir.
    document.addEventListener('DOMContentLoaded', () => {

        // --- Firebase Kurulumu ---
        const firebaseConfig = {
            apiKey: "AIzaSyDYkzZzNXB22U4oEXxOoPh-puwuE8kz0g4",
            authDomain: "pufemo-com.firebaseapp.com",
            projectId: "pufemo-com",
            storageBucket: "pufemo-com.appspot.com",
            messagingSenderId: "983352837227",
            appId: "1:983352837227:web:defaa8dae215776e2e1d2e",
            measurementId: "G-RH8XHC7P91"
        };
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();
        const auth = firebase.auth();

        // --- Global Değişkenler ---
        let pricingSettings = null;

        // --- DOM Elementleri ---
        const calculateBtn = document.getElementById('calculate-btn');
        const calculatorSection = document.getElementById('calculator-section');
        const calculatorForm = document.getElementById('calculator-form');
        const addToCartBtn = document.getElementById('add-to-cart-btn');
        const cartCounter = document.getElementById('cart-counter');
        // ... (diğer tüm modal ve butonlar da benzer şekilde alınabilir)

        // --- Fonksiyonlar ---
        const showToast = (message) => {
            const toast = document.getElementById('toast');
            toast.querySelector('span').textContent = message;
            toast.classList.add('opacity-100');
            setTimeout(() => { toast.classList.remove('opacity-100'); }, 3000);
        };

        const updateCartCounter = () => {
            const cart = JSON.parse(sessionStorage.getItem('shoppingCart')) || [];
            const count = cart.reduce((sum, item) => sum + item.quantity, 0);
            if (count > 0) {
                cartCounter.textContent = count;
                cartCounter.classList.remove('hidden');
            } else {
                cartCounter.classList.add('hidden');
            }
        };

        const handleAddToCart = (e) => {
            e.preventDefault();
            if (!auth.currentUser) { showToast("Lütfen önce giriş yapın."); return; }
            if (!pricingSettings) { showToast('Fiyat ayarları yüklenemedi, lütfen yöneticiye bildirin.'); return; }
            
            const formData = {
                productLink: calculatorForm.querySelector('#product-link').value.trim(),
                productPrice: parseFloat(calculatorForm.querySelector('#product-price').value),
                productCategory: calculatorForm.querySelector('#product-category').value,
                orderMethod: calculatorForm.querySelector('#order-method').value
            };

            if (!formData.productLink || isNaN(formData.productPrice) || !formData.productCategory || !formData.orderMethod) {
                showToast('Lütfen tüm alanları doldurun.');
                return;
            }

            const cart = JSON.parse(sessionStorage.getItem('shoppingCart')) || [];
            const existingItemIndex = cart.findIndex(item => item.productLink === formData.productLink);
            const categoryFeeRate = pricingSettings.categoryRates[formData.productCategory] || 0;

            if (existingItemIndex > -1) {
                cart[existingItemIndex].quantity++;
            } else {
                cart.push({ ...formData, calculatedCategoryFee: formData.productPrice * categoryFeeRate, quantity: 1 });
            }

            sessionStorage.setItem('shoppingCart', JSON.stringify(cart));
            showToast('Ürün sepetinize eklendi!');
            updateCartCounter();
            calculatorForm.reset();
            calculatorSection.classList.add('hidden');
        };

        // --- Sayfa Yüklendiğinde Başlatılacak İşlemler ---

        // 1. Gerekli verileri veritabanından çek.
        db.collection('settings').doc('pricing').get()
            .then(doc => {
                if (doc.exists) {
                    pricingSettings = doc.data();
                    addToCartBtn.disabled = false;
                    addToCartBtn.textContent = 'Sepete Ekle';
                } else {
                    addToCartBtn.textContent = 'Sistem Hatası';
                    showToast('Fiyat ayarları bulunamadı.');
                }
            })
            .catch(err => {
                console.error("Pricing settings fetch error:", err);
                addToCartBtn.textContent = 'Sistem Hatası';
                showToast('Ayarlar yüklenirken hata oluştu.');
            });

        // 2. Butonların tıklama olaylarını ayarla.
        calculateBtn.addEventListener('click', () => {
            calculatorSection.classList.toggle('hidden');
            if (!calculatorSection.classList.contains('hidden')) {
                calculatorSection.scrollIntoView({ behavior: 'smooth' });
            }
        });

        calculatorForm.addEventListener('submit', handleAddToCart);

        // 3. Kullanıcı giriş/çıkış durumlarını dinle.
        auth.onAuthStateChanged(user => {
            const loginBtn = document.getElementById('login-btn');
            const profileContainer = document.getElementById('profile-container');
            if(user) {
                loginBtn.classList.add('hidden');
                profileContainer.classList.remove('hidden');
                document.getElementById('profile-img').src = user.photoURL || `https://ui-avatars.com/api/?name=${user.email}`;
            } else {
                loginBtn.classList.remove('hidden');
                profileContainer.classList.add('hidden');
            }
        });
        
        // 4. Sepet sayacını ilk yüklemede güncelle.
        updateCartCounter();
    });
</script>

</body>
</html>
