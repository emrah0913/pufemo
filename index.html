<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PUFEMO - Ana Sayfa</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <style>
        body { display: flex; flex-direction: column; min-height: 100vh; background-color: #f8f9fa; }
        .footer { background-color: #343a40; color: white; margin-top: auto; }
        .product-card { transition: all 0.3s ease; }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .hero-slider .carousel-item img { height: 550px; object-fit: cover; }
        .category-card img { width: 100px; height: 100px; object-fit: cover; }

        /* Ülke Seçim Modalı ve Header için Stiller */
        .modal-country-selection .modal-content { border-radius: 15px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .modal-country-selection .modal-header, .modal-country-selection .modal-footer { border: none; padding-top: 0; padding-bottom: 0; }
        .currency-language-selector { cursor: pointer; padding: 5px 10px; border-radius: 5px; transition: background-color 0.2s; }
        .currency-language-selector:hover { background-color: #e9ecef; }
    </style>
</head>
<body>

    <header class="py-3 mb-4 border-bottom bg-white shadow-sm">
        <div class="container d-flex flex-wrap justify-content-center">
            <a href="/" class="d-flex align-items-center mb-3 mb-lg-0 me-lg-auto text-dark text-decoration-none">
                <span class="fs-4 fw-bold">PUFEMO</span>
            </a>
            <form class="col-12 col-lg-auto mb-3 mb-lg-0" role="search">
                <input type="search" class="form-control" placeholder="Ara..." aria-label="Search">
            </form>
        </div>
    </header>

    <nav class="navbar navbar-expand-lg bg-body-tertiary rounded" aria-label="Eleventh navbar example">
        <div class="container">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsExample09" aria-controls="navbarsExample09" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarsExample09">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link active" aria-current="page" href="index.html">Ana Sayfa</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">Ürünler</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">Hakkımızda</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">İletişim</a></li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarAccountDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-person"></i> Hesabım</a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarAccountDropdown">
                            <li><a class="dropdown-item" href="admin-login.html">Giriş Yap</a></li>
                            <li><a class="dropdown-item" href="kayit-ol.html">Kayıt Ol</a></li>
                        </ul>
                    </li>
                    <li class="nav-item"><a class="nav-link" href="sepet.html"><i class="bi bi-cart"></i> Sepet <span class="badge bg-dark rounded-pill" id="cart-item-count">0</span></a></li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle currency-language-selector" href="#" id="currencyLanguageDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <span id="selected-country-display">TR</span> / <span id="selected-language-display">TR</span> / <span id="selected-currency-display">₺</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="currencyLanguageDropdown">
                            <li><h6 class="dropdown-header">Ülke Seçimi</h6></li>
                            <li><select class="form-select form-select-sm mx-3 mb-2" id="header-country-select"></select></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><h6 class="dropdown-header">Dil Seçimi</h6></li>
                            <li><select class="form-select form-select-sm mx-3 mb-2" id="header-language-select"></select></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><h6 class="dropdown-header">Para Birimi Seçimi</h6></li>
                            <li><select class="form-select form-select-sm mx-3 mb-2" id="header-currency-select"></select></li>
                            <li><button class="btn btn-primary btn-sm w-75 mx-auto d-block mt-2" id="save-header-selections">Uygula</button></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container my-4">
        <div id="heroCarousel" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-indicators" id="carousel-indicators"></div>
            <div class="carousel-inner" id="carousel-inner">
                <div class="carousel-item active"><div class="d-flex justify-content-center align-items-center" style="height:550px;"><div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div></div></div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev"><span class="carousel-control-prev-icon"></span></button>
            <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next"><span class="carousel-control-next-icon"></span></button>
        </div>
    </div>

    <div class="container my-5">
        <h2 class="text-center mb-4">Kategoriler</h2>
        <div class="row g-4 justify-content-center" id="featured-categories-row">
            </div>
    </div>

    <div class="container my-5">
        <h2 class="text-center mb-4">Öne Çıkan Ürünler</h2>
        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4" id="featured-products-row">
            </div>
    </div>

    <div class="container my-5">
        <div class="row g-4">
            <div class="col-md-3 text-center"><h5><i class="bi bi-truck"></i> Hızlı & Ücretsiz Kargo</h5><p>Belirli bir tutar üzerindeki tüm siparişlerde ücretsiz kargo.</p></div>
            <div class="col-md-3 text-center"><h5><i class="bi bi-shield-check"></i> Güvenli Alışveriş</h5><p>Ödemeleriniz 256-bit SSL sertifikası ile korunmaktadır.</p></div>
            <div class="col-md-3 text-center"><h5><i class="bi bi-arrow-repeat"></i> Kolay İade</h5><p>Memnun kalmazsanız 14 gün içinde kolay iade imkanı.</p></div>
            <div class="col-md-3 text-center"><h5><i class="bi bi-headset"></i> 7/24 Destek</h5><p>Her türlü sorunuz için müşteri hizmetlerimiz yanınızda.</p></div>
        </div>
    </div>

    <footer class="footer py-5">
        <div class="container">
            <div class="row">
                <div class="col-6 col-md-3 mb-3"><h5>PUFEMO</h5><p class="text-body-secondary">Kaliteli ve modern mobilyanın adresi.</p></div>
                <div class="col-6 col-md-3 mb-3"><h5>Hızlı Linkler</h5><ul class="nav flex-column"><li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-body-secondary">Hakkımızda</a></li><li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-body-secondary">Gizlilik Politikası</a></li></ul></div>
                <div class="col-6 col-md-3 mb-3"><h5>Bize Ulaşın</h5><ul class="nav flex-column"><li class="nav-item mb-2" id="footer-contact-email">info@pufemo.com</li><li class="nav-item mb-2" id="footer-whatsapp-number">+90 5XX XXX XX XX</li></ul></div>
                <div class="col-6 col-md-3 mb-3"><h5>Sosyal Medya</h5><ul class="nav list-unstyled d-flex"><li><a class="text-body-secondary" href="#"><i class="bi bi-twitter fs-4"></i></a></li><li class="ms-3"><a class="text-body-secondary" href="#"><i class="bi bi-instagram fs-4"></i></a></li><li class="ms-3"><a class="text-body-secondary" href="#"><i class="bi bi-facebook fs-4"></i></a></li></ul></div>
            </div>
            <div class="d-flex justify-content-between py-4 my-4 border-top"><p>© 2025 Pufemo, Inc. Tüm hakları saklıdır.</p></div>
        </div>
    </footer>

    <div class="modal fade" id="welcomeCountryModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-sm modal-country-selection">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title w-100 text-center" id="welcomeCountryModalLabel">Hoş Geldiniz!</h5></div>
                <div class="modal-body text-center">
                    <p id="welcome-country-prompt">Lütfen ülkenizi seçin:</p>
                    <select class="form-select mb-3" id="country-select-modal"></select>
                </div>
                <div class="modal-footer justify-content-center"><button type="button" class="btn btn-primary" id="select-country-btn">Devam Et</button></div>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // FİREBASE YAPILANDIRMASI
        const firebaseConfig = { apiKey: "AIzaSyDYkzZzNXB22U4oEXxOoPh-puwuE8kz0g4", authDomain: "pufemo-com.firebaseapp.com", projectId: "pufemo-com", storageBucket: "pufemo-com.appspot.com", messagingSenderId: "983352837227", appId: "1:983352837227:web:defaa8dae215776e2e1d2" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // GLOBAL DEĞİŞKENLER VE DOM ELEMENTLERİ
        const welcomeCountryModal = new bootstrap.Modal(document.getElementById('welcomeCountryModal'));
        const countrySelectModal = document.getElementById('country-select-modal');
        const selectCountryBtn = document.getElementById('select-country-btn');
        // ... (diğer dom elementleri)
        let allCountries = [], allLanguages = [], allCurrencies = [], siteSettings = {};
        const LS_SELECTED_COUNTRY_CODE = 'pufemo_selected_country_code';
        const LS_SELECTED_LANGUAGE_CODE = 'pufemo_selected_language_code';
        const LS_SELECTED_CURRENCY_CODE = 'pufemo_selected_currency_code';
        
        // ÇOK DİLLİ METİNLER
        const appTexts = {
            'tr': { welcomeModalTitle: 'Hoş Geldiniz!', welcomeModalCountryPrompt: 'Lütfen ülkenizi seçin:', welcomeModalContinueBtn: 'Devam Et', countrySelectPlaceholder: 'Ülke Seçiniz...', noSliders: 'Slider Mevcut Değil', noCategories: 'Kategori Bulunamadı', productsLoading: 'Ürünler Yükleniyor...', noProducts: 'Ürün Bulunamadı' },
            'en': { welcomeModalTitle: 'Welcome!', welcomeModalCountryPrompt: 'Please select your country:', welcomeModalContinueBtn: 'Continue', countrySelectPlaceholder: 'Select Country...', noSliders: 'No Sliders Available', noCategories: 'No Categories Found', productsLoading: 'Loading Products...', noProducts: 'No Products Found' }
        };

        // SAYFA YÜKLEME AKIŞI
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const [countriesSnapshot, languagesSnapshot, currenciesSnapshot, settingsDoc] = await Promise.all([
                    db.collection('countries').get(), db.collection('languages').get(), db.collection('currencies').get(), db.collection('settings').doc('siteConfig').get()
                ]);
                allCountries = countriesSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                allLanguages = languagesSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                allCurrencies = currenciesSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                siteSettings = settingsDoc.exists ? settingsDoc.data() : {};
            } catch (error) { console.error("Veritabanı verileri çekilirken hata:", error); }

            auth.onAuthStateChanged(async (user) => {
                if (!user) { try { await auth.signInAnonymously(); } catch (e) { console.error("Anonim oturum hatası:", e); } }
                
                const storedCountryCode = localStorage.getItem(LS_SELECTED_COUNTRY_CODE);
                if (!storedCountryCode && allCountries.length > 0) {
                    showCountrySelectionModal();
                } else if (storedCountryCode) {
                    initializePageContent();
                } else {
                    // Hiç ülke tanımlı değilse varsayılan olarak devam et
                    initializePageContent();
                }
            });
        });

        function showCountrySelectionModal() {
            let initialLang = 'en';
            const texts = appTexts[initialLang] || appTexts['en'];
            document.getElementById('welcomeCountryModalLabel').textContent = texts.welcomeModalTitle;
            document.getElementById('welcome-country-prompt').textContent = texts.welcomeModalCountryPrompt;
            selectCountryBtn.textContent = texts.welcomeModalContinueBtn;
            countrySelectModal.innerHTML = `<option value="">${texts.countrySelectPlaceholder}</option>`;
            allCountries.forEach(country => {
                countrySelectModal.innerHTML += `<option value="${country.code}">${country.name_en || country.name_tr}</option>`;
            });
            welcomeCountryModal.show();
        }

        selectCountryBtn.addEventListener('click', () => {
            const selectedCountryCode = countrySelectModal.value;
            if (selectedCountryCode) {
                const selectedCountryData = allCountries.find(c => c.code === selectedCountryCode);
                if (selectedCountryData) {
                    localStorage.setItem(LS_SELECTED_COUNTRY_CODE, selectedCountryCode);
                    localStorage.setItem(LS_SELECTED_LANGUAGE_CODE, selectedCountryData.language || 'tr');
                    localStorage.setItem(LS_SELECTED_CURRENCY_CODE, selectedCountryData.currency || 'TRY');
                }
                welcomeCountryModal.hide();
                initializePageContent();
            }
        });

        function initializePageContent() {
            updateHeaderAndFooter();
            populateHeaderSelectors();
            loadHeroSlider();
            loadFeaturedCategories();
            loadFeaturedProducts();
        }

        function updateHeaderAndFooter() {
            const lang = localStorage.getItem(LS_SELECTED_LANGUAGE_CODE) || 'tr';
            // Header metinleri
            document.getElementById('menu-login-link').textContent = appTexts[lang]?.menuLogin || 'Login';
            document.getElementById('menu-register-link').textContent = appTexts[lang]?.menuRegister || 'Register';
            // Footer metinleri
            document.querySelector('#footer-contact-email').textContent = siteSettings.contactEmail || 'info@pufemo.com';
            document.querySelector('#footer-whatsapp-number').textContent = siteSettings.whatsappNumber || '+90 5XX XXX XX XX';
            // Cart
            const cartItems = JSON.parse(localStorage.getItem('pufemo_cart_items') || '[]');
            document.getElementById('cart-item-count').textContent = cartItems.length;
        }

        function populateHeaderSelectors() {
            const lang = localStorage.getItem(LS_SELECTED_LANGUAGE_CODE) || 'tr';
            const country = localStorage.getItem(LS_SELECTED_COUNTRY_CODE) || 'TR';
            const currency = localStorage.getItem(LS_SELECTED_CURRENCY_CODE) || 'TRY';
            // ... (populate select options) ...
            document.getElementById('selected-country-display').textContent = country;
            document.getElementById('selected-language-display').textContent = lang.toUpperCase();
            document.getElementById('selected-currency-display').textContent = allCurrencies.find(c => c.code === currency)?.symbol || '₺';
        }

        saveHeaderSelectionsBtn.addEventListener('click', () => {
            localStorage.setItem(LS_SELECTED_COUNTRY_CODE, document.getElementById('header-country-select').value);
            localStorage.setItem(LS_SELECTED_LANGUAGE_CODE, document.getElementById('header-language-select').value);
            localStorage.setItem(LS_SELECTED_CURRENCY_CODE, document.getElementById('header-currency-select').value);
            window.location.reload();
        });

        // VERİ ÇEKME FONKSİYONLARI
        async function loadHeroSlider() {
            const carouselInner = document.getElementById('carousel-inner');
            const carouselIndicators = document.getElementById('carousel-indicators');
            carouselInner.innerHTML = ''; carouselIndicators.innerHTML = '';
            const lang = localStorage.getItem(LS_SELECTED_LANGUAGE_CODE) || 'tr';
            try {
                const snapshot = await db.collection('homepage_slider').where('isActive', '==', true).orderBy('order').get();
                if(snapshot.empty){
                    carouselInner.innerHTML = `<div class="carousel-item active"><div class="d-flex justify-content-center align-items-center h-100"><p>${appTexts[lang].noSliders}</p></div></div>`;
                    return;
                }
                snapshot.forEach((doc, index) => {
                    const slide = doc.data();
                    const title = slide['title_' + lang] || '';
                    const description = slide['description_' + lang] || '';
                    const buttonText = slide['buttonText_' + lang] || 'Shop Now';
                    
                    const indicator = `<button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="${index}" class="${index === 0 ? 'active' : ''}"></button>`;
                    const item = `<div class="carousel-item ${index === 0 ? 'active' : ''}">
                                    <img src="${slide.imageUrl}" class="d-block w-100" alt="...">
                                    <div class="carousel-caption d-none d-md-block">
                                        <h1>${title}</h1>
                                        <p>${description}</p>
                                        <p><a class="btn btn-lg btn-primary" href="${slide.linkUrl || '#'}">${buttonText}</a></p>
                                    </div>
                                  </div>`;
                    carouselIndicators.innerHTML += indicator;
                    carouselInner.innerHTML += item;
                });
            } catch (e) { console.error("Slider yüklenirken hata:", e); }
        }

        async function loadFeaturedCategories() {
            const container = document.getElementById('featured-categories-row');
            container.innerHTML = `<div class="col text-center"><div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div></div>`;
            const lang = localStorage.getItem(LS_SELECTED_LANGUAGE_CODE) || 'tr';
            try {
                const snapshot = await db.collection('categories').where('showOnHomepage', '==', true).limit(4).get();
                if(snapshot.empty){
                     container.innerHTML = `<div class="col"><p>${appTexts[lang].noCategories}</p></div>`;
                     return;
                }
                container.innerHTML = '';
                snapshot.forEach(doc => {
                    const category = doc.data();
                    const name = category['name_' + lang] || category.name_tr;
                    const item = `<div class="col-6 col-md-3">
                                    <div class="card category-card text-center border-0">
                                        <img src="${category.imageUrl}" class="rounded-circle mx-auto" alt="${name}">
                                        <div class="card-body">
                                            <h5 class="card-title">${name}</h5>
                                        </div>
                                    </div>
                                  </div>`;
                    container.innerHTML += item;
                });
            } catch (e) { console.error("Kategoriler yüklenirken hata:", e); }
        }

        async function loadFeaturedProducts() {
            const container = document.getElementById('featured-products-row');
            container.innerHTML = `<div class="col text-center"><p>${appTexts[localStorage.getItem(LS_SELECTED_LANGUAGE_CODE) || 'tr'].productsLoading}</p></div>`;
            const lang = localStorage.getItem(LS_SELECTED_LANGUAGE_CODE) || 'tr';
            const countryCode = localStorage.getItem(LS_SELECTED_COUNTRY_CODE) || 'TR';
            const currencyCode = localStorage.getItem(LS_SELECTED_CURRENCY_CODE) || 'TRY';
            const currencySymbol = allCurrencies.find(c => c.code === currencyCode)?.symbol || '₺';
            const countryMultiplier = allCountries.find(c => c.code === countryCode)?.multiplier || 1;

            try {
                const snapshot = await db.collection('products').where('isActive', '==', true).limit(8).get();
                 if(snapshot.empty){
                     container.innerHTML = `<div class="col"><p>${appTexts[lang].noProducts}</p></div>`;
                     return;
                }
                container.innerHTML = '';
                snapshot.forEach(doc => {
                    const product = doc.data();
                    const name = product['name_' + lang] || product.name_tr;
                    const price = (product.basePriceTRY * countryMultiplier).toFixed(2);
                    const item = `<div class="col">
                                    <div class="card product-card h-100">
                                        <img src="${product.mediaUrls && product.mediaUrls.length > 0 ? product.mediaUrls[0] : 'https://via.placeholder.com/300'}" class="card-img-top" alt="${name}">
                                        <div class="card-body text-center">
                                            <h5 class="card-title">${name}</h5>
                                            <p class="card-text fw-bold">${price} ${currencySymbol}</p>
                                            <div class="d-flex justify-content-center">
                                                 <button class="btn btn-sm btn-outline-dark">Sepete Ekle</button>
                                            </div>
                                        </div>
                                    </div>
                                  </div>`;
                    container.innerHTML += item;
                });
            } catch (e) { console.error("Ürünler yüklenirken hata:", e); }
        }
    </script>
</body>
</html>
