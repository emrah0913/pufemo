<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Türkiye'den Kıbrıs'a Sipariş Getirme Hizmeti | Getir Kıbrıs</title>
<meta name="description" content="Trendyol, Hepsiburada ve diğer Türkiye sitelerinden Kıbrıs'a kolay ve hızlı ürün getiriyoruz. Hemen hesaplayın ve sipariş verin.">
<link rel="icon" href="/favicon.ico?v=1" type="image/x-icon">
<script src="https://cdn.tailwindcss.com/3.4.16"></script>
<script>
    tailwind.config = {
        theme: {
            extend: {
                colors: { primary: '#5d3ebc', secondary: '#ffd300' },
                borderRadius: { DEFAULT: '8px', button: '8px' }
            }
        }
    }
</script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css">
<style>
    body { font-family: 'Inter', sans-serif; background-color: #f9f9f9; }
</style>
</head>
<body class="bg-gray-50">
<div class="w-full max-w-screen-lg mx-auto relative min-h-screen pb-16">

    <header class="fixed top-0 w-full bg-white shadow-sm z-50 px-4 py-3 flex items-center justify-between">
        <div class="flex-1"></div>
        <a href="index.html" class="flex flex-col items-center"><img src="logom.png" alt="Getir Kıbrıs" class="h-12"></a>
        <div class="flex-1 flex justify-end items-center gap-4">
            <a href="sepet.html" class="relative text-gray-600 hover:text-primary">
                <i class="ri-shopping-cart-line ri-xl"></i>
                <span id="cart-counter" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center hidden">0</span>
            </a>
            <div id="auth-button" class="w-8 h-8 flex items-center justify-center">
                <button id="login-btn" class="text-primary font-medium cursor-pointer"><i class="ri-user-line ri-lg"></i></button>
                <div id="profile-container" class="hidden"><img id="profile-img" src="" alt="Profil" class="w-8 h-8 rounded-full cursor-pointer"></div>
            </div>
        </div>
    </header>

    <main class="pt-20 pb-20">
        <div class="relative w-full h-64 sm:h-80 lg:h-[450px] overflow-hidden mb-8">
            <video class="w-full h-full object-cover" autoplay loop muted playsinline poster="https://readdy.ai/api/search-image?query=online%20shopping%20and%20delivery%20service%2C%20modern%20lifestyle%2C%20soft%20lighting%2C%20clean%20background%2C%20banner%20image&width=800&height=400&seq=1&orientation=landscape">
                <source src="https://public.readdy.ai/assets/sample.mp4" type="video/mp4">
            </video>
            <div class="absolute inset-0 bg-gradient-to-t from-primary/70 to-transparent pointer-events-none"></div>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 px-4 mb-8">
            <button id="calculate-btn" class="bg-white shadow-md p-4 rounded-button flex flex-col items-center justify-center h-32 cursor-pointer border hover:border-primary/20 transition-all">
                <div class="w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mb-2"><i class="ri-calculator-line ri-xl text-primary"></i></div>
                <span class="text-sm font-medium">Hesapla & Sepete Ekle</span>
            </button>
            <a href="sepet.html" id="my-orders-btn" class="bg-white shadow-md p-4 rounded-button flex flex-col items-center justify-center h-32 cursor-pointer border hover:border-primary/20 transition-all">
                <div class="w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mb-2"><i class="ri-file-list-3-line ri-xl text-primary"></i></div>
                <span class="text-sm font-medium">Siparişlerim</span>
            </a>
            <a href="https://wa.me/905391090879" target="_blank" class="bg-white shadow-md p-4 rounded-button flex flex-col items-center justify-center h-32 cursor-pointer border hover:border-primary/20 transition-all">
                <div class="w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mb-2"><i class="ri-whatsapp-line ri-xl text-primary"></i></div>
                <span class="text-sm font-medium">WhatsApp Destek</span>
            </a>
        </div>

        <div id="calculator-section" class="bg-white rounded-lg shadow-md mx-4 p-6 mb-8 hidden">
             <h3 class="text-lg font-semibold mb-4 text-primary">Ürün Bilgilerini Girin</h3>
             <form id="calculator-form" class="space-y-4">
                <div>
                    <label for="order-method" class="block text-sm font-medium text-gray-700 mb-1">Sipariş Yöntemi<span class="text-red-500">*</span></label>
                    <select id="order-method" required class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:border-primary"><option value="" disabled selected>Seçin...</option><option value="self">Ürünü ben alacağım, kargo sizden</option><option value="service">Ürünü benim için siz alın</option></select>
                </div>
                <div>
                    <label for="product-link" class="block text-sm font-medium text-gray-700 mb-1">Ürün Linki<span class="text-red-500">*</span></label>
                    <input type="url" id="product-link" required class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:border-primary" placeholder="https://...">
                </div>
                <div>
                    <label for="product-price" class="block text-sm font-medium text-gray-700 mb-1">Ürün Fiyatı (₺)<span class="text-red-500">*</span></label>
                    <input type="number" id="product-price" required class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:border-primary" placeholder="0.00" step="any" min="0.01">
                </div>
                <div>
                    <label for="product-category" class="block text-sm font-medium text-gray-700 mb-1">Kategori<span class="text-red-500">*</span></label>
                    <select id="product-category" required class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:border-primary"><option value="" disabled selected>Seçin...</option><option value="furniture">Mobilya</option><option value="electronics">Elektronik</option><option value="clothing">Giyim</option><option value="cosmetics">Kozmetik</option><option value="stationery">Kırtasiye</option></select>
                </div>
                <button type="submit" id="add-to-cart-btn" class="w-full bg-primary text-white py-3 rounded-button font-medium hover:bg-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>Ayarlar Yükleniyor...</button>
             </form>
        </div>

        <section id="testimonials-section" class="px-4 py-8 mb-8">
            <h3 class="text-2xl font-bold text-center text-primary mb-8">Müşterilerimiz Ne Diyor?</h3>
            <div id="testimonials-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </section>
    </main>
    <footer class="w-full py-4 text-center"><p class="text-xs text-gray-500 mt-2">&copy; 2025 Getir Kıbrıs.</p></footer>
</div>

<div id="login-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden"><div class="bg-white rounded-lg p-6 w-full max-w-xs relative"><button id="close-login-modal" class="absolute top-3 right-3"><i class="ri-close-line ri-lg"></i></button><h3 class="text-xl font-semibold text-center mb-4">Giriş Yap</h3><button id="google-login-btn" class="w-full flex items-center justify-center gap-2 border rounded py-3 font-medium hover:bg-gray-50"><i class="ri-google-fill text-red-500"></i>Google ile Giriş</button></div></div>
<div id="auth-required-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden"><div class="bg-white rounded-lg p-6 w-full max-w-xs text-center"><h3 class="text-xl font-semibold">Giriş Gerekli</h3><p class="text-sm mt-2">Bu özelliği kullanmak için giriş yapmalısınız.</p><button id="auth-login-btn" class="w-full mt-6 bg-primary text-white py-2 rounded">Giriş Yap</button><button id="close-auth-modal" class="w-full mt-1 py-2">Kapat</button></div></div>
<div id="complete-profile-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden"><div class="bg-white rounded-lg p-6 w-full max-w-sm"><h3 class="text-xl font-semibold mb-4">Profilinizi Tamamlayın</h3><form id="complete-profile-form" class="space-y-4"><input type="text" id="profile-fullname" placeholder="Ad Soyad" required class="w-full p-2 border rounded"><input type="tel" id="profile-phone" placeholder="Telefon" required class="w-full p-2 border rounded"><textarea id="profile-address" placeholder="Varsayılan Teslimat Adresi" required rows="3" class="w-full p-2 border rounded"></textarea><button type="submit" class="w-full bg-primary text-white py-2 rounded">Kaydet</button></form></div></div>
<div id="toast" class="fixed bottom-20 left-1/2 -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded-lg opacity-0 transition-all duration-300"><span id="toast-message"></span></div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
    const firebaseConfig = {
      apiKey: "AIzaSyDYkzZzNXB22U4oEXxOoPh-puwuE8kz0g4",
      authDomain: "pufemo-com.firebaseapp.com",
      projectId: "pufemo-com",
      storageBucket: "pufemo-com.appspot.com",
      messagingSenderId: "983352837227",
      appId: "1:983352837227:web:defaa8dae215776e2e1d2e",
      measurementId: "G-RH8XHC7P91"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    const app = {
        pricingSettings: null,
        init() {
            this.cacheDOMElements();
            this.setupEventListeners();
            this.handleAuthChanges();
            this.updateCartCounter();
            this.fetchData();
        },
        cacheDOMElements() {
            this.dom = {
                calculateBtn: document.getElementById('calculate-btn'),
                calculatorSection: document.getElementById('calculator-section'),
                calculatorForm: document.getElementById('calculator-form'),
                addToCartBtn: document.getElementById('add-to-cart-btn'),
                cartCounter: document.getElementById('cart-counter'),
                testimonialsContainer: document.getElementById('testimonials-container'),
                loginBtn: document.getElementById('login-btn'),
                profileContainer: document.getElementById('profile-container'),
                profileImg: document.getElementById('profile-img'),
                loginModal: {
                    el: document.getElementById('login-modal'),
                    closeBtn: document.getElementById('close-login-modal'),
                    googleBtn: document.getElementById('google-login-btn')
                },
                authRequiredModal: {
                    el: document.getElementById('auth-required-modal'),
                    loginBtn: document.getElementById('auth-login-btn'),
                    closeBtn: document.getElementById('close-auth-modal'),
                },
                completeProfileModal: {
                    el: document.getElementById('complete-profile-modal'),
                    form: document.getElementById('complete-profile-form'),
                    fullname: document.getElementById('profile-fullname'),
                    phone: document.getElementById('profile-phone'),
                    address: document.getElementById('profile-address')
                }
            };
        },
        setupEventListeners() {
            this.dom.calculateBtn.addEventListener('click', () => {
                this.dom.calculatorSection.classList.toggle('hidden');
                if(!this.dom.calculatorSection.classList.contains('hidden')) {
                    this.dom.calculatorSection.scrollIntoView({behavior: 'smooth'});
                }
            });
            this.dom.calculatorForm.addEventListener('submit', (e) => this.handleAddToCart(e));
            this.dom.loginBtn.addEventListener('click', () => this.showModal(this.dom.loginModal.el));
            this.dom.loginModal.closeBtn.addEventListener('click', () => this.hideModal(this.dom.loginModal.el));
            this.dom.loginModal.googleBtn.addEventListener('click', () => this.signInWithGoogle());
            this.dom.profileContainer.addEventListener('click', () => this.signOut());
            this.dom.authRequiredModal.loginBtn.addEventListener('click', () => {
                this.hideModal(this.dom.authRequiredModal.el);
                this.showModal(this.dom.loginModal.el);
            });
            this.dom.authRequiredModal.closeBtn.addEventListener('click', () => this.hideModal(this.dom.authRequiredModal.el));
            this.dom.completeProfileModal.form.addEventListener('submit', (e) => this.handleProfileCompletion(e));
        },
        async fetchData() {
            try {
                const pricingDoc = await db.collection('settings').doc('pricing').get();
                if (pricingDoc.exists) {
                    this.pricingSettings = pricingDoc.data();
                    this.dom.addToCartBtn.disabled = false;
                    this.dom.addToCartBtn.textContent = 'Sepete Ekle';
                } else {
                    this.showToast('Fiyat ayarları bulunamadı. Lütfen yönetici ile iletişime geçin.');
                    this.dom.addToCartBtn.disabled = true;
                    this.dom.addToCartBtn.textContent = 'Sistem Hatası';
                }
            } catch (error) {
                console.error("Fiyat ayarları çekilemedi:", error);
                this.showToast('Sistem ayarları yüklenemedi, lütfen tekrar deneyin.');
                this.dom.addToCartBtn.disabled = true;
                 this.dom.addToCartBtn.textContent = 'Sistem Hatası';
            }
            this.fetchAndDisplayReviews();
        },
        handleAuthChanges() {
            auth.onAuthStateChanged(async (user) => {
                if (user) {
                    this.dom.loginBtn.classList.add('hidden');
                    this.dom.profileContainer.classList.remove('hidden');
                    this.dom.profileImg.src = user.photoURL || `https://ui-avatars.com/api/?name=${user.email}&background=5d3ebc&color=fff`;
                    const userRef = db.collection('users').doc(user.uid);
                    const userDoc = await userRef.get();
                    if (!userDoc.exists) {
                        this.dom.completeProfileModal.fullname.value = user.displayName || '';
                        this.showModal(this.dom.completeProfileModal.el);
                    }
                } else {
                    this.dom.loginBtn.classList.remove('hidden');
                    this.dom.profileContainer.classList.add('hidden');
                }
            });
        },
        handleAddToCart(e) {
            e.preventDefault();
            if (!auth.currentUser) { this.showModal(this.dom.authRequiredModal.el); return; }
            if (!this.pricingSettings) { this.showToast('Fiyat ayarları hala yükleniyor, lütfen bekleyin.'); return; }

            const formData = {
                productLink: this.dom.calculatorForm.querySelector('#product-link').value.trim(),
                productPrice: parseFloat(this.dom.calculatorForm.querySelector('#product-price').value),
                productCategory: this.dom.calculatorForm.querySelector('#product-category').value,
                orderMethod: this.dom.calculatorForm.querySelector('#order-method').value
            };

            if (!formData.productLink || isNaN(formData.productPrice) || !formData.productCategory || !formData.orderMethod) {
                this.showToast('Lütfen tüm alanları doldurun.');
                return;
            }

            const cart = JSON.parse(sessionStorage.getItem('shoppingCart')) || [];
            const existingItemIndex = cart.findIndex(item => item.productLink === formData.productLink);
            const categoryFeeRate = this.pricingSettings.categoryRates[formData.productCategory] || 0;

            if (existingItemIndex > -1) {
                cart[existingItemIndex].quantity++;
            } else {
                cart.push({ ...formData, calculatedCategoryFee: formData.productPrice * categoryFeeRate, quantity: 1 });
            }
            sessionStorage.setItem('shoppingCart', JSON.stringify(cart));
            this.showToast('Ürün sepetinize eklendi!');
            this.updateCartCounter();
            this.dom.calculatorForm.reset();
            this.dom.calculatorSection.classList.add('hidden');
        },
        async fetchAndDisplayReviews() {
             this.dom.testimonialsContainer.innerHTML = '';
             try {
                const snapshot = await db.collection('reviews').where('isApproved', '==', true).orderBy('createdAt', 'desc').limit(3).get();
                if (snapshot.empty) {
                    this.dom.testimonialsContainer.innerHTML = '<p class="col-span-full text-center text-gray-500">Henüz müşteri yorumu yok.</p>';
                    return;
                }
                snapshot.forEach(doc => {
                    const review = doc.data();
                    const card = document.createElement('div');
                    card.className = 'bg-white p-6 rounded-lg shadow-md text-center';
                    card.innerHTML = `<i class="ri-double-quotes-l text-4xl text-primary/30"></i><p class="text-gray-600 my-4 italic">“${review.reviewText}”</p><div class="font-semibold text-gray-800">${review.userName}</div><div class="flex justify-center text-yellow-400 mt-2">${[...Array(5)].map((_, i) => `<i class="ri-star-${i < review.rating ? 'fill' : 'line'}"></i>`).join('')}</div>`;
                    this.dom.testimonialsContainer.appendChild(card);
                });
             } catch (error) { console.error("Yorumlar çekilemedi:", error); }
        },
        signInWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider).then(() => {
                this.hideModal(this.dom.loginModal.el);
                this.showToast('Giriş başarılı!');
            }).catch(err => this.showToast(`Giriş hatası: ${err.message}`));
        },
        signOut() {
            if (confirm('Çıkış yapmak istediğinize emin misiniz?')) {
                auth.signOut().then(() => this.showToast('Başarıyla çıkış yapıldı.')).catch(err => console.error(err));
            }
        },
        async handleProfileCompletion(e) {
            e.preventDefault();
            const user = auth.currentUser;
            if (!user) return;
            const userData = {
                displayName: this.dom.completeProfileModal.fullname.value,
                phone: this.dom.completeProfileModal.phone.value,
                deliveryAddress: this.dom.completeProfileModal.address.value,
                email: user.email,
                role: 'user',
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            try {
                await db.collection('users').doc(user.uid).set(userData);
                this.hideModal(this.dom.completeProfileModal.el);
                this.showToast('Profiliniz başarıyla kaydedildi!');
            } catch (error) { this.showToast('Profil kaydedilirken hata oluştu.'); }
        },
        showModal(el) { el.classList.remove('hidden'); },
        hideModal(el) { el.classList.add('hidden'); },
        updateCartCounter() {
            const cart = JSON.parse(sessionStorage.getItem('shoppingCart')) || [];
            const count = cart.reduce((sum, item) => sum + item.quantity, 0);
            if (count > 0) {
                this.dom.cartCounter.textContent = count;
                this.dom.cartCounter.classList.remove('hidden');
            } else {
                this.dom.cartCounter.classList.add('hidden');
            }
        }
    };

    app.init();
</script>

</body>
</html>
