<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PUFEMO - Ana Sayfa</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background-color: #f8f9fa;
        }
        .navbar {
            background-color: #ffffff;
            box-shadow: 0 2px 4px rgba(0,0,0,.08);
        }
        .footer {
            background-color: #343a40;
            color: white;
            padding: 30px 0;
            margin-top: auto;
        }
        .hero-slider {
            height: 500px; /* Adjust as needed */
            background-color: #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #495057;
            font-size: 2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        .hero-slider .carousel-item img {
            width: 100%;
            height: 500px;
            object-fit: cover;
            filter: brightness(70%); /* Darken image for text readability */
        }
        .hero-slider .carousel-caption {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        .product-card {
            border: none;
            box-shadow: 0 4px 8px rgba(0,0,0,.05);
            transition: transform 0.2s ease-in-out;
        }
        .product-card:hover {
            transform: translateY(-5px);
        }
        .product-card img {
            height: 200px;
            object-fit: cover;
        }
        .modal-country-selection .modal-content,
        .modal-auth .modal-content {
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .modal-country-selection .modal-header,
        .modal-auth .modal-header {
            border-bottom: none;
            padding-bottom: 0;
        }
        .modal-country-selection .modal-footer,
        .modal-auth .modal-footer {
            border-top: none;
            padding-top: 0;
        }
        .currency-language-selector {
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 5px;
            transition: background-color 0.2s;
        }
        .currency-language-selector:hover {
            background-color: #e9ecef;
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container">
            <a class="navbar-brand fw-bold" href="index.html">PUFEMO</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="#">Ana Sayfa</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Ürünler</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Kategoriler</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">İletişim</a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="bi bi-person-circle"></i> Hesabım</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="sepet.html"><i class="bi bi-cart-fill"></i> Sepet <span class="badge bg-primary rounded-pill" id="cart-item-count">0</span></a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle currency-language-selector" href="#" id="currencyLanguageDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <span id="selected-country-display"></span> / <span id="selected-language-display"></span> / <span id="selected-currency-display"></span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="currencyLanguageDropdown">
                            <li><h6 class="dropdown-header">Ülke Seçimi</h6></li>
                            <li>
                                <select class="form-select form-select-sm mx-3 mb-2" id="header-country-select">
                                    </select>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li><h6 class="dropdown-header">Dil Seçimi</h6></li>
                            <li>
                                <select class="form-select form-select-sm mx-3 mb-2" id="header-language-select">
                                    </select>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li><h6 class="dropdown-header">Para Birimi Seçimi</h6></li>
                            <li>
                                <select class="form-select form-select-sm mx-3 mb-2" id="header-currency-select">
                                    </select>
                            </li>
                            <li><button class="btn btn-primary btn-sm w-75 mx-auto d-block mt-2" id="save-header-selections">Uygula</button></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <main class="container my-4 flex-grow-1">

        <div class="alert alert-info text-center" role="alert" id="promo-banner">
            Ücretsiz Kargo Fırsatını Kaçırmayın!
        </div>

        <section class="hero-slider rounded shadow-sm mb-4">
            <div id="heroCarousel" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-indicators">
                    </div>
                <div class="carousel-inner" id="carousel-inner">
                    <div class="carousel-item active">
                        <img src="https://via.placeholder.com/1500x500/cccccc/ffffff?text=Slider+Görseli+1" class="d-block w-100" alt="Slider 1">
                        <div class="carousel-caption d-none d-md-block">
                            <h5>Yeni Sezon Ürünleri Keşfedin</h5>
                            <p>En güncel koleksiyonlarımızla tarzınızı yenileyin.</p>
                            <a href="#" class="btn btn-light btn-lg mt-3">Şimdi Keşfet</a>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <img src="https://via.placeholder.com/1500x500/aaaaaa/ffffff?text=Slider+Görseli+2" class="d-block w-100" alt="Slider 2">
                        <div class="carousel-caption d-none d-md-block">
                            <h5>Büyük İndirimler Başladı!</h5>
                            <p>Seçili ürünlerde %50'ye varan indirimler.</p>
                            <a href="#" class="btn btn-light btn-lg mt-3">Fırsatları Yakala</a>
                        </div>
                    </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </section>

        <section class="my-5">
            <h2 class="text-center mb-4">Öne Çıkan Kategoriler</h2>
            <div class="row row-cols-1 row-cols-md-3 g-4" id="featured-categories">
                <div class="col">
                    <div class="card h-100 text-center product-card">
                        <img src="https://via.placeholder.com/400x250/f0f0f0/333333?text=Giyim" class="card-img-top" alt="Giyim">
                        <div class="card-body">
                            <h5 class="card-title">Giyim</h5>
                            <a href="#" class="btn btn-outline-primary btn-sm">Keşfet</a>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card h-100 text-center product-card">
                        <img src="https://via.placeholder.com/400x250/e0e0e0/333333?text=Elektronik" class="card-img-top" alt="Elektronik">
                        <div class="card-body">
                            <h5 class="card-title">Elektronik</h5>
                            <a href="#" class="btn btn-outline-primary btn-sm">Keşfet</a>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card h-100 text-center product-card">
                        <img src="https://via.placeholder.com/400x250/d0d0d0/333333?text=Ev+ve+Yaşam" class="card-img-top" alt="Ev ve Yaşam">
                        <div class="card-body">
                            <h5 class="card-title">Ev ve Yaşam</h5>
                            <a href="#" class="btn btn-outline-primary btn-sm">Keşfet</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="my-5">
            <h2 class="text-center mb-4">Yeni Gelen Ürünler</h2>
            <div class="row row-cols-1 row-cols-md-4 g-4" id="new-arrivals">
                <div class="col">
                    <div class="card product-card">
                        <img src="https://via.placeholder.com/300x200/f5f5f5/333333?text=Ürün+1" class="card-img-top" alt="Ürün 1">
                        <div class="card-body text-center">
                            <h5 class="card-title">Modern T-Shirt</h5>
                            <p class="card-text fw-bold">199.99 TL</p>
                            <button class="btn btn-primary btn-sm">Sepete Ekle</button>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card product-card">
                        <img src="https://via.placeholder.com/300x200/f5f5f5/333333?text=Ürün+2" class="card-img-top" alt="Ürün 2">
                        <div class="card-body text-center">
                            <h5 class="card-title">Kablosuz Kulaklık</h5>
                            <p class="card-text fw-bold">899.00 TL</p>
                            <button class="btn btn-primary btn-sm">Sepete Ekle</button>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card product-card">
                        <img src="https://via.placeholder.com/300x200/f5f5f5/333333?text=Ürün+3" class="card-img-top" alt="Ürün 3">
                        <div class="card-body text-center">
                            <h5 class="card-title">Akıllı Saat</h5>
                            <p class="card-text fw-bold">1299.50 TL</p>
                            <button class="btn btn-primary btn-sm">Sepete Ekle</button>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card product-card">
                        <img src="https://via.placeholder.com/300x200/f5f5f5/333333?text=Ürün+4" class="card-img-top" alt="Ürün 4">
                        <div class="card-body text-center">
                            <h5 class="card-title">Spor Ayakkabı</h5>
                            <p class="card-text fw-bold">450.00 TL</p>
                            <button class="btn btn-primary btn-sm">Sepete Ekle</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-3">
                    <h5 class="text-white">PUFEMO</h5>
                    <p>Kalite ve şıklığın adresi.</p>
                    <p id="footer-company-address">Adres bilgisi yüklenecek...</p>
                </div>
                <div class="col-md-4 mb-3">
                    <h5 class="text-white">Hızlı Linkler</h5>
                    <ul class="list-unstyled">
                        <li><a href="#" class="text-white text-decoration-none">Hakkımızda</a></li>
                        <li><a href="#" class="text-white text-decoration-none">Gizlilik Politikası</a></li>
                        <li><a href="#" class="text-white text-decoration-none">Mesafeli Satış Sözleşmesi</a></li>
                        <li><a href="siparis-takip.html" class="text-white text-decoration-none">Sipariş Takip</a></li>
                    </ul>
                </div>
                <div class="col-md-4 mb-3">
                    <h5 class="text-white">Bize Ulaşın</h5>
                    <ul class="list-unstyled">
                        <li><i class="bi bi-envelope-fill me-2"></i> <span id="footer-contact-email">info@pufemo.com</span></li>
                        <li><i class="bi bi-whatsapp me-2"></i> <span id="footer-whatsapp-number">+90 5XX XXX XX XX</span></li>
                    </ul>
                    <div class="social-icons mt-3">
                        <a href="#" class="text-white me-3"><i class="bi bi-facebook fs-4"></i></a>
                        <a href="#" class="text-white me-3"><i class="bi bi-instagram fs-4"></i></a>
                        <a href="#" class="text-white"><i class="bi bi-twitter fs-4"></i></a>
                    </div>
                </div>
            </div>
            <div class="text-center mt-4 border-top pt-3">
                <p class="mb-0">&copy; 2025 PUFEMO. Tüm Hakları Saklıdır.</p>
            </div>
        </div>
    </footer>

    <div class="modal fade" id="welcomeCountryModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="welcomeCountryModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-sm modal-country-selection">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title w-100 text-center" id="welcomeCountryModalLabel">Hoş Geldiniz!</h5>
                </div>
                <div class="modal-body text-center">
                    <p>Lütfen ülkenizi seçin:</p>
                    <select class="form-select mb-3" id="country-select-modal">
                        </select>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-primary" id="select-country-btn">Devam Et</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="authModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="authModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-sm modal-auth">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title w-100 text-center" id="authModalLabel">Nasıl Devam Etmek İstersiniz?</h5>
                </div>
                <div class="modal-body text-center">
                    <div class="d-grid gap-2">
                        <a href="admin-login.html" class="btn btn-success btn-lg">Giriş Yap</a>
                        <button type="button" class="btn btn-outline-primary btn-lg">Kayıt Ol</button>
                        <button type="button" class="btn btn-secondary btn-lg" id="continue-as-guest-btn">Misafir Olarak Devam Et</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Firebase Yapılandırması (admin panelinizden kopyalandı)
        const firebaseConfig = {
            apiKey: "AIzaSyDYkzZzNXB22U4oEXxOoPh-puwuE8kz0g4",
            authDomain: "pufemo-com.firebaseapp.com",
            projectId: "pufemo-com",
            storageBucket: "pufemo-com.firebasestorage.app",
            messagingSenderId: "983352837227",
            appId: "1:983352837227:web:defaa8dae215776e2e1d2e",
            measurementId: "G-RH8XHC7P91"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Modallar
        const welcomeCountryModal = new bootstrap.Modal(document.getElementById('welcomeCountryModal'));
        const authModal = new bootstrap.Modal(document.getElementById('authModal'));

        // Seçim Elementleri
        const countrySelectModal = document.getElementById('country-select-modal');
        const selectCountryBtn = document.getElementById('select-country-btn');
        const continueAsGuestBtn = document.getElementById('continue-as-guest-btn');

        const selectedCountryDisplay = document.getElementById('selected-country-display');
        const selectedLanguageDisplay = document.getElementById('selected-language-display');
        const selectedCurrencyDisplay = document.getElementById('selected-currency-display');

        const headerCountrySelect = document.getElementById('header-country-select');
        const headerLanguageSelect = document.getElementById('header-language-select');
        const headerCurrencySelect = document.getElementById('header-currency-select');
        const saveHeaderSelectionsBtn = document.getElementById('save-header-selections');

        let allCountries = [];
        let allLanguages = [];
        let allCurrencies = [];
        let siteSettings = {}; // Genel site ayarları (IBAN, email vb.)

        // Local Storage Anahtarları
        const LS_SELECTED_COUNTRY_CODE = 'pufemo_selected_country_code';
        const LS_SELECTED_LANGUAGE_CODE = 'pufemo_selected_language_code';
        const LS_SELECTED_CURRENCY_CODE = 'pufemo_selected_currency_code';

        // Sayfa yüklendiğinde çalışacak ana fonksiyon
        document.addEventListener('DOMContentLoaded', async () => {
            await loadInitialDataAndShowModals();
            await loadSiteSettings(); // Footer ve diğer statik alanlar için ayarları yükle
            await populateHeaderSelectors(); // Header'daki dil/para birimi/ülke seçicilerini doldur
            updateHeaderDisplays(); // Header'daki mevcut seçimleri göster
            // Diğer dinamik içerikleri yükle (slider, kategoriler, ürünler)
            loadHeroSlider();
            loadFeaturedCategories();
            loadNewArrivals();
        });

        async function loadInitialDataAndShowModals() {
            try {
                // Ülkeleri, dilleri ve para birimlerini Firebase'den çek
                const [countriesSnapshot, languagesSnapshot, currenciesSnapshot] = await Promise.all([
                    db.collection('countries').get(),
                    db.collection('languages').get(),
                    db.collection('currencies').get()
                ]);

                allCountries = countriesSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                allLanguages = languagesSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                allCurrencies = currenciesSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

                // Modal'daki ülke seçicisini doldur
                countrySelectModal.innerHTML = '<option value="">Ülke Seçiniz...</option>';
                allCountries.forEach(country => {
                    const option = document.createElement('option');
                    option.value = country.code;
                    option.textContent = country.name;
                    countrySelectModal.appendChild(option);
                });

                // Daha önce bir ülke seçilmiş mi kontrol et
                const storedCountryCode = localStorage.getItem(LS_SELECTED_COUNTRY_CODE);

                if (!storedCountryCode) {
                    // Hiç seçim yapılmamışsa hoş geldiniz modalını göster
                    welcomeCountryModal.show();
                } else {
                    // Daha önce seçim yapılmışsa, direkt yetkilendirme modalını göster
                    // Ve seçimleri yükle
                    setSelectedCountry(storedCountryCode);
                    authModal.show();
                }

            } catch (error) {
                console.error("Başlangıç verileri yüklenirken hata:", error);
                // Hata durumunda bile yetkilendirme modalını göster, belki kullanıcı devam etmek ister
                authModal.show();
            }
        }

        async function loadSiteSettings() {
            try {
                const settingsDoc = await db.collection('settings').doc('siteConfig').get();
                if (settingsDoc.exists) {
                    siteSettings = settingsDoc.data();
                    // Footer bilgilerini güncelle
                    const currentLangCode = localStorage.getItem(LS_SELECTED_LANGUAGE_CODE) || 'tr'; // Varsayılan dil
                    document.getElementById('footer-company-address').textContent = siteSettings[`companyAddress_${currentLangCode}`] || 'Adres bilgisi bulunamadı.';
                    document.getElementById('footer-contact-email').textContent = siteSettings.contactEmail || 'info@pufemo.com';
                    document.getElementById('footer-whatsapp-number').textContent = siteSettings.whatsappNumber || '+90 5XX XXX XX XX';
                    document.getElementById('promo-banner').textContent = siteSettings[`promotionText_${currentLangCode}`] || 'Harika fırsatlar için bizi takip edin!'; // Örnek promosyon metni
                }
            } catch (error) {
                console.error("Site ayarları yüklenirken hata:", error);
            }
        }

        async function populateHeaderSelectors() {
            // Header'daki ülke seçicisini doldur
            headerCountrySelect.innerHTML = '';
            allCountries.forEach(country => {
                const option = document.createElement('option');
                option.value = country.code;
                option.textContent = country.name;
                headerCountrySelect.appendChild(option);
            });

            // Header'daki dil seçicisini doldur
            headerLanguageSelect.innerHTML = '';
            allLanguages.forEach(lang => {
                const option = document.createElement('option');
                option.value = lang.code;
                option.textContent = lang.name;
                headerLanguageSelect.appendChild(option);
            });

            // Header'daki para birimi seçicisini doldur
            headerCurrencySelect.innerHTML = '';
            allCurrencies.forEach(currency => {
                const option = document.createElement('option');
                option.value = currency.code;
                option.textContent = currency.symbol + ' (' + currency.code + ')';
                headerCurrencySelect.appendChild(option);
            });

            // Mevcut seçimleri header select box'larında seçili hale getir
            headerCountrySelect.value = localStorage.getItem(LS_SELECTED_COUNTRY_CODE) || '';
            headerLanguageSelect.value = localStorage.getItem(LS_SELECTED_LANGUAGE_CODE) || '';
            headerCurrencySelect.value = localStorage.getItem(LS_SELECTED_CURRENCY_CODE) || '';
        }

        function updateHeaderDisplays() {
            const currentCountryCode = localStorage.getItem(LS_SELECTED_COUNTRY_CODE);
            const currentLanguageCode = localStorage.getItem(LS_SELECTED_LANGUAGE_CODE);
            const currentCurrencyCode = localStorage.getItem(LS_SELECTED_CURRENCY_CODE);

            const selectedCountry = allCountries.find(c => c.code === currentCountryCode);
            const selectedLanguage = allLanguages.find(l => l.code === currentLanguageCode);
            const selectedCurrency = allCurrencies.find(c => c.code === currentCurrencyCode);

            selectedCountryDisplay.textContent = selectedCountry ? selectedCountry.code.toUpperCase() : 'TR'; // Varsayılan TR
            selectedLanguageDisplay.textContent = selectedLanguage ? selectedLanguage.code.toUpperCase() : 'TR'; // Varsayılan TR
            selectedCurrencyDisplay.textContent = selectedCurrency ? selectedCurrency.symbol : '₺'; // Varsayılan TL sembolü
        }

        async function setSelectedCountry(countryCode) {
            localStorage.setItem(LS_SELECTED_COUNTRY_CODE, countryCode);

            const selectedCountryData = allCountries.find(c => c.code === countryCode);
            if (selectedCountryData) {
                // Ülkeye atanmış varsayılan dil ve para birimini ayarla
                localStorage.setItem(LS_SELECTED_LANGUAGE_CODE, selectedCountryData.defaultLanguageCode || 'tr'); // Varsayılan 'tr'
                localStorage.setItem(LS_SELECTED_CURRENCY_CODE, selectedCountryData.defaultCurrencyCode || 'TRY'); // Varsayılan 'TRY'
            } else {
                // Ülke bulunamazsa varsayılanları ayarla
                localStorage.setItem(LS_SELECTED_LANGUAGE_CODE, 'tr');
                localStorage.setItem(LS_SELECTED_CURRENCY_CODE, 'TRY');
            }
            updateHeaderDisplays();
            await loadSiteSettings(); // Dil değiştiği için footer'ı ve promosyonu güncelle
            // Burada sayfanın dinamik içeriğini (ürünler, kategoriler vb.) yeniden yükleme fonksiyonları çağrılabilir.
            // Örneğin: loadProducts(currentLanguageCode, currentCurrencyCode);
        }

        // Event Listeners
        selectCountryBtn.addEventListener('click', () => {
            const selectedCountryCode = countrySelectModal.value;
            if (selectedCountryCode) {
                setSelectedCountry(selectedCountryCode);
                welcomeCountryModal.hide();
                authModal.show(); // Ülke seçildikten sonra yetkilendirme modalını göster
            } else {
                alert('Lütfen bir ülke seçiniz.');
            }
        });

        continueAsGuestBtn.addEventListener('click', () => {
            authModal.hide();
            // Misafir olarak devam etme mantığı burada işlenebilir
        });

        saveHeaderSelectionsBtn.addEventListener('click', () => {
            localStorage.setItem(LS_SELECTED_COUNTRY_CODE, headerCountrySelect.value);
            localStorage.setItem(LS_SELECTED_LANGUAGE_CODE, headerLanguageSelect.value);
            localStorage.setItem(LS_SELECTED_CURRENCY_CODE, headerCurrencySelect.value);
            updateHeaderDisplays();
            loadSiteSettings(); // Dil değiştiği için footer'ı ve promosyonu güncelle
            // Sayfanın dinamik içeriğini yeniden yükle
            loadHeroSlider();
            loadFeaturedCategories();
            loadNewArrivals();
            alert('Ayarlar güncellendi!');
        });

        // --- Dinamik İçerik Yükleme Fonksiyonları (Firebase'den veri çekecek) ---

        async function loadHeroSlider() {
            const carouselInner = document.getElementById('carousel-inner');
            const carouselIndicators = document.querySelector('.carousel-indicators');
            carouselInner.innerHTML = '';
            carouselIndicators.innerHTML = '';

            const currentLanguageCode = localStorage.getItem(LS_SELECTED_LANGUAGE_CODE) || 'tr';

            try {
                const sliderSnapshot = await db.collection('sliders').where('isActive', '==', true).orderBy('order').get();
                if (sliderSnapshot.empty) {
                    carouselInner.innerHTML = `<div class="carousel-item active">
                        <img src="https://via.placeholder.com/1500x500/cccccc/ffffff?text=Slider+Görseli+Yok" class="d-block w-100" alt="No Slider">
                        <div class="carousel-caption d-none d-md-block">
                            <h5>Slider Bulunamadı</h5>
                            <p>Yönetici panelinden slider ekleyebilirsiniz.</p>
                        </div>
                    </div>`;
                    return;
                }

                sliderSnapshot.docs.forEach((doc, index) => {
                    const slider = doc.data();
                    const isActive = index === 0 ? 'active' : '';
                    const title = slider[`title_${currentLanguageCode}`] || slider.title_tr || 'Başlık Yok';
                    const description = slider[`description_${currentLanguageCode}`] || slider.description_tr || 'Açıklama Yok';
                    const imageUrl = slider.imageUrl || 'https://via.placeholder.com/1500x500/cccccc/ffffff?text=Resim+Yok';
                    const link = slider.link || '#';

                    carouselIndicators.innerHTML += `<button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="${index}" class="${isActive}" aria-current="${isActive ? 'true' : 'false'}" aria-label="Slide ${index + 1}"></button>`;

                    carouselInner.innerHTML += `
                        <div class="carousel-item ${isActive}">
                            <img src="${imageUrl}" class="d-block w-100" alt="${title}">
                            <div class="carousel-caption d-none d-md-block">
                                <h5>${title}</h5>
                                <p>${description}</p>
                                <a href="${link}" class="btn btn-light btn-lg mt-3">Şimdi Keşfet</a>
                            </div>
                        </div>`;
                });
            } catch (error) {
                console.error("Slider yüklenirken hata:", error);
            }
        }

        async function loadFeaturedCategories() {
            const featuredCategoriesContainer = document.getElementById('featured-categories');
            featuredCategoriesContainer.innerHTML = '';
            const currentLanguageCode = localStorage.getItem(LS_SELECTED_LANGUAGE_CODE) || 'tr';

            try {
                // Kategori yönetimi sayfanızdaki "vitrinde göster" veya benzeri bir alanı kullanarak filtreleme yapılabilir.
                // Şimdilik tüm kategorileri alalım ve ilk 3'ünü gösterelim.
                const categoriesSnapshot = await db.collection('categories').get();
                const categories = categoriesSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

                // Sadece aktif ve vitrinde gösterilecek kategorileri filtrele
                const activeFeaturedCategories = categories.filter(cat => cat.isActive && cat.showOnHomepage).slice(0, 3); // İlk 3 veya belirli sayıda

                if (activeFeaturedCategories.length === 0) {
                    featuredCategoriesContainer.innerHTML = `<p class="text-center col-12">Gösterilecek öne çıkan kategori bulunamadı.</p>`;
                    return;
                }

                activeFeaturedCategories.forEach(category => {
                    const categoryName = category[`name_${currentLanguageCode}`] || category.name_tr || 'Kategori Adı Yok';
                    const imageUrl = category.imageUrl || 'https://via.placeholder.com/400x250/f0f0f0/333333?text=Kategori'; // Varsayılan resim
                    // Kategori detay sayfasına link (henüz yok, placeholder)
                    const link = `category.html?id=${category.id}`;

                    featuredCategoriesContainer.innerHTML += `
                        <div class="col">
                            <div class="card h-100 text-center product-card">
                                <img src="${imageUrl}" class="card-img-top" alt="${categoryName}">
                                <div class="card-body">
                                    <h5 class="card-title">${categoryName}</h5>
                                    <a href="${link}" class="btn btn-outline-primary btn-sm">Keşfet</a>
                                </div>
                            </div>
                        </div>`;
                });
            } catch (error) {
                console.error("Öne çıkan kategoriler yüklenirken hata:", error);
            }
        }

        async function loadNewArrivals() {
            const newArrivalsContainer = document.getElementById('new-arrivals');
            newArrivalsContainer.innerHTML = '';
            const currentLanguageCode = localStorage.getItem(LS_SELECTED_LANGUAGE_CODE) || 'tr';
            const currentCurrencyCode = localStorage.getItem(LS_SELECTED_CURRENCY_CODE) || 'TRY';
            const currentCountryCode = localStorage.getItem(LS_SELECTED_COUNTRY_CODE) || 'TR';

            try {
                // En yeni ürünleri veya "vitrinde göster" olarak işaretlenmiş ürünleri çek
                // Product management sayfanızdaki 'createdAt' veya 'isNewArrival' gibi alanlar kullanılabilir.
                const productsSnapshot = await db.collection('products')
                                                .where('isActive', '==', true)
                                                .orderBy('createdAt', 'desc') // En yenileri almak için
                                                .limit(8) // Örneğin son 8 ürün
                                                .get();

                if (productsSnapshot.empty) {
                    newArrivalsContainer.innerHTML = `<p class="text-center col-12">Gösterilecek yeni ürün bulunamadı.</p>`;
                    return;
                }

                const products = productsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

                // Ülkeye göre fiyat çarpanını al
                const selectedCountryData = allCountries.find(c => c.code === currentCountryCode);
                const priceMultiplier = selectedCountryData ? (selectedCountryData.priceMultiplier || 1) : 1;

                products.forEach(product => {
                    const productName = product[`name_${currentLanguageCode}`] || product.name_tr || 'Ürün Adı Yok';
                    const imageUrl = product.mainImageUrl || 'https://via.placeholder.com/300x200/f5f5f5/333333?text=Ürün';
                    let price = product.price || 0; // Varsayılan fiyat

                    // Fiyatı para birimine ve ülke çarpanına göre ayarla
                    price = (price * priceMultiplier).toFixed(2); // 2 ondalık basamak

                    const selectedCurrencySymbol = allCurrencies.find(c => c.code === currentCurrencyCode)?.symbol || '₺';

                    // Ürün detay sayfasına link (henüz yok, placeholder)
                    const link = `urun-detay.html?id=${product.id}`;

                    newArrivalsContainer.innerHTML += `
                        <div class="col">
                            <div class="card product-card">
                                <img src="${imageUrl}" class="card-img-top" alt="${productName}">
                                <div class="card-body text-center">
                                    <h5 class="card-title">${productName}</h5>
                                    <p class="card-text fw-bold">${price} ${selectedCurrencySymbol}</p>
                                    <a href="${link}" class="btn btn-primary btn-sm">İncele</a>
                                </div>
                            </div>
                        </div>`;
                });
            } catch (error) {
                console.error("Yeni ürünler yüklenirken hata:", error);
            }
        }

        // Sepet sayacı için basit bir placeholder (gerçek sepet mantığı daha sonra eklenecek)
        function updateCartItemCount() {
            const cartItems = JSON.parse(localStorage.getItem('pufemo_cart_items') || '[]');
            document.getElementById('cart-item-count').textContent = cartItems.length;
        }
        updateCartItemCount(); // Sayfa yüklendiğinde sepet sayacını güncelle

    </script>
</body>
</html>
