<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PUFEMO - Ürün Detay</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: sans-serif; }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">

  <div class="max-w-5xl mx-auto p-4">
    <button onclick="history.back()" class="text-blue-600 mb-4">← Geri Dön</button>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-start">
      <div>
        <img id="productImage" src="" class="w-full rounded shadow" alt="Ürün görseli"/>
      </div>
      <div>
        <h1 id="productName" class="text-3xl font-bold mb-2">Ürün Adı</h1>
        <p id="productDescription" class="text-gray-700 mb-4">Ürün açıklaması</p>
        <div id="freeShippingBadge" class="mb-4 hidden">
          <span class="inline-block bg-green-500 text-white text-xs px-3 py-1 rounded">Ücretsiz Kargo</span>
        </div>
        <div class="mb-4">
          <label for="variantSelect" class="block text-sm font-medium">Varyant Seçimi:</label>
          <select id="variantSelect" class="mt-1 block w-full border px-3 py-2 rounded"></select>
        </div>
        <div class="text-2xl font-bold text-red-600 mb-4">
          <span id="productPrice">0.00</span> <span id="productCurrency">TRY</span>
        </div>
        <button id="addToCartBtn" class="px-6 py-2 bg-primary text-white rounded hover:bg-blue-700 transition">
          Sepete Ekle
        </button>
      </div>
    </div>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDYkzZzNXB22U4oEXxOoPh-puwuE8kz0g4",
      authDomain: "pufemo-com.firebaseapp.com",
      projectId: "pufemo-com",
      storageBucket: "pufemo-com.firebasestorage.app",
      messagingSenderId: "983352837227",
      appId: "1:983352837227:web:defaa8dae215776e2e1d2e"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const urlParams = new URLSearchParams(window.location.search);
    const productId = urlParams.get("id");
    let currentLanguage = 'tr';
    let currentCurrency = 'TRY';
    let currencyRates = {
      TRY: 1,
      USD: 0.031,
      EUR: 0.029,
      GBP: 0.025
    };

    function convertCurrency(price) {
      const rate = currencyRates[currentCurrency] || 1;
      return (price * rate).toFixed(2);
    }

    async function loadProduct() {
      if (!productId) return;
      const productRef = doc(db, "pufemo-products", productId);
      const snap = await getDoc(productRef);
      if (!snap.exists()) return;
      const data = snap.data();

      const content = data.content?.[currentLanguage] || data.content?.tr || {};
      const variant = data.variants?.[0];

      document.getElementById("productImage").src = variant?.media?.[0]?.url || "https://placehold.co/400";
      document.getElementById("productName").textContent = content.name || "Ürün Adı";
      document.getElementById("productDescription").textContent = content.description || "Açıklama yok.";

      if (data.freeShipping && content.freeShippingText) {
        const badge = document.getElementById("freeShippingBadge");
        badge.classList.remove("hidden");
        badge.querySelector("span").textContent = content.freeShippingText;
      }

      const select = document.getElementById("variantSelect");
      select.innerHTML = "";
      (data.variants || []).forEach((v, i) => {
        const opt = document.createElement("option");
        opt.value = i;
        opt.textContent = v.name || `Varyant ${i+1}`;
        select.appendChild(opt);
      });

      document.getElementById("productPrice").textContent = convertCurrency(data.discountedPrice || data.price || 0);
      document.getElementById("productCurrency").textContent = currentCurrency;
    }

    loadProduct();
  </script>
</body>
</html>
