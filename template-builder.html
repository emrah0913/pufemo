<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Malzeme Türü Oluştur</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDYkzZzNXB22U4oEXxOoPh-puwuE8kz0g4",
      authDomain: "pufemo-com.firebaseapp.com",
      projectId: "pufemo-com",
      storageBucket: "pufemo-com.appspot.com",
      messagingSenderId: "983352837227",
      appId: "1:983352837227:web:defaa8dae215776e2e1d2e",
      measurementId: "G-RH8XHC7P91"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const fieldList = document.getElementById("fieldList");
    const addFieldBtn = document.getElementById("addField");
    const saveBtn = document.getElementById("saveTemplate");

    addFieldBtn.addEventListener("click", () => {
      const div = document.createElement("div");
      div.className = "flex gap-2 items-center mb-2";
      div.innerHTML = `
        <input type="text" placeholder="Alan Adı" class="border p-2 rounded w-1/3" />
        <select class="border p-2 rounded w-1/3">
          <option value="text">Metin</option>
          <option value="number">Sayı</option>
          <option value="select">Seçenek</option>
        </select>
        <input type="text" placeholder="Birim (opsiyonel)" class="border p-2 rounded w-1/3" />
        <button class="text-red-600" onclick="this.parentElement.remove()">Sil</button>
      `;
      fieldList.appendChild(div);
    });

    saveBtn.addEventListener("click", async () => {
      const typeName = document.getElementById("typeName").value.trim();
      if (!typeName) return alert("Malzeme türü adı gerekli");

      const fields = [];
      fieldList.querySelectorAll("div").forEach(div => {
        const inputs = div.querySelectorAll("input, select");
        fields.push({
          name: inputs[0].value.trim(),
          type: inputs[1].value,
          unit: inputs[2].value.trim()
        });
      });

      if (fields.some(f => !f.name)) return alert("Tüm alanlara isim girin");

      await addDoc(collection(db, "templates"), {
        type: typeName,
        fields
      });

      alert("Şablon kaydedildi!");
      location.href = "materials.html";
    });
  </script>
</head>
<body class="bg-gray-100 text-gray-800 p-6">
  <div class="max-w-3xl mx-auto bg-white p-6 rounded shadow">
    <h1 class="text-2xl font-bold mb-4">Yeni Malzeme Türü Oluştur</h1>
    <input id="typeName" type="text" placeholder="Malzeme Türü Adı (örn: MDF, menteşe)" class="border p-2 rounded w-full mb-4">

    <h2 class="text-lg font-semibold mb-2">Alanlar</h2>
    <div id="fieldList"></div>
    <button id="addField" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 mt-2">+ Alan Ekle</button>

    <div class="mt-6 text-right">
      <button id="saveTemplate" class="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700">Şablonu Kaydet</button>
    </div>
  </div>
</body>
</html>
